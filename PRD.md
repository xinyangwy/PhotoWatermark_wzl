# 照片水印工具 产品需求文档

## 1. 产品概述

照片水印工具是一款轻量级命令行应用程序，用于自动为图片添加基于EXIF信息的日期水印。该工具旨在帮助用户批量处理照片，在保留原始图片拍摄日期信息的同时，提供可自定义样式的水印功能。

### 1.1 产品定位
- 面向需要批量为照片添加日期水印的个人用户或小型团队
- 提供简单易用的命令行界面，支持灵活的水印样式定制
- 作为图片管理工作流中的辅助工具，提高照片管理效率

### 1.2 产品目标
- 实现自动从图片EXIF信息提取拍摄日期并添加为水印
- 提供灵活的水印样式定制选项
- 支持批量处理多张图片
- 确保处理后的图片质量不降低
- 提供友好的用户反馈

## 2. 产品功能

### 2.1 核心功能

#### 2.1.1 单张图片处理
- 用户可指定单张图片文件路径进行处理
- 程序自动读取图片的EXIF信息，提取拍摄日期（年月日）
- 在图片上添加日期水印，并保存为新文件

#### 2.1.2 批量图片处理
- 用户可指定包含多张图片的目录路径进行处理
- 程序自动识别目录中的所有支持格式的图片文件
- 批量为所有图片添加日期水印，并分别保存为新文件

#### 2.1.3 水印样式定制
- 支持自定义水印的字体大小
- 支持自定义水印的颜色（包括透明度）
- 支持自定义水印在图片上的位置

#### 2.1.4 输出管理
- 自动创建输出目录（原目录名_watermark）
- 将处理后的图片保存在输出目录中，保持原始文件名不变

### 2.2 辅助功能

#### 2.2.1 EXIF信息读取
- 从图片文件中提取EXIF元数据
- 查找并解析拍摄日期信息

#### 2.2.2 日期格式处理
- 将EXIF中的日期格式转换为统一的YYYY-MM-DD格式
- 在无法获取EXIF日期时，使用当前日期作为水印

#### 2.2.3 错误处理
- 处理无法读取的图片文件
- 处理没有EXIF信息或拍摄日期的情况
- 提供清晰的错误提示

#### 2.2.4 进度反馈
- 显示处理进度和结果
- 提供成功/失败状态反馈

## 3. 用户界面

### 3.1 命令行界面
- 支持通过命令行参数指定输入路径、水印样式等选项
- 提供清晰的命令行帮助信息
- 提供实时的处理状态反馈

### 3.2 命令行参数

| 参数 | 短参数 | 类型 | 默认值 | 描述 |
|------|--------|------|--------|------|
| input_path | - | 字符串 | 必填 | 图片文件路径或包含图片的目录路径 |
| --font-size | -s | 整数 | 36 | 水印字体大小 |
| --color | -c | 字符串 | 255,255,255,128 | 水印颜色，格式为r,g,b,a（0-255） |
| --position | -p | 字符串 | right_bottom | 水印位置（left_top, center_top, right_top, left_center, center, right_center, left_bottom, center_bottom, right_bottom） |
| --help | -h | 无 | 无 | 显示帮助信息 |

## 4. 技术要求

### 4.1 开发语言
- Python 3.6 或更高版本

### 4.2 依赖库
- Pillow 9.0.0 或更高版本（用于图像处理）

### 4.3 支持的图片格式
- JPEG (.jpg, .jpeg)
- PNG (.png)
- TIFF (.tiff)
- BMP (.bmp)

### 4.4 跨平台支持
- Windows
- macOS
- Linux

## 5. 性能要求

### 5.1 处理速度
- 对于单张图片，处理时间应小于2秒
- 对于批量处理，处理速度应与系统硬件性能相适应

### 5.2 资源占用
- 内存占用应根据处理图片的数量和大小合理控制
- CPU占用应保持在合理范围内，不影响其他系统进程

## 6. 部署要求

### 6.1 安装方式
- 通过Python包管理器pip安装依赖库
- 直接运行Python脚本

### 6.2 运行环境
- 需要Python 3.6或更高版本
- 需要安装必要的依赖库

## 7. 测试需求

### 7.1 功能测试
- 测试单张图片处理功能
- 测试批量图片处理功能
- 测试不同水印样式定制功能
- 测试不同图片格式的兼容性

### 7.2 边界测试
- 测试无EXIF信息的图片处理
- 测试大尺寸图片的处理
- 测试大量图片的批量处理

### 7.3 兼容性测试
- 测试在不同操作系统上的兼容性
- 测试在不同Python版本上的兼容性

## 8. 项目结构

```
PhotoWatermark_wzl/
├── photo_watermark.py  # 主程序文件
├── test_image.py       # 测试图片生成脚本
├── requirements.txt    # 项目依赖
├── README.md           # 项目文档
├── LICENSE             # 许可证文件
└── images/             # 示例图片目录
    ├── [示例图片文件]
    └── images_watermark/  # 处理后的示例图片目录
```

## 9. 附录

### 9.1 术语定义
- **EXIF**: Exchangeable Image File Format，可交换图像文件格式，是一种标准，用于存储数字照片的元数据
- **水印**: 在图片上添加的文字或图形，用于标识图片信息
- **RGBA**: Red, Green, Blue, Alpha的缩写，代表红、绿、蓝三原色和透明度通道

### 9.2 参考资料
- [Pillow官方文档](https://pillow.readthedocs.io/)
- [EXIF标准](https://en.wikipedia.org/wiki/Exif)

### 9.3 版本历史
- **版本 1.0.0**: 初始版本，实现基本功能
  - 支持单张和批量图片处理
  - 支持自定义水印字体大小、颜色和位置
  - 自动提取EXIF日期信息
  - 保存处理后的图片到新目录